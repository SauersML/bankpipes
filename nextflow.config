// nextflow.config

// Enable Nextflow DSL2
nextflow.enable.dsl = 2

// -------------------------------------------------------
// Pipeline parameters
// -------------------------------------------------------
params {
    // Input Data
    wgs_vds_path                   = 'gs://fc-aou-datasets-controlled/v7/wgs/short_read/snpindel/vds/hail.vds'
    flagged_samples_gcs_path       = 'gs://fc-aou-datasets-controlled/v7/wgs/short_read/snpindel/aux/relatedness/relatedness_flagged_samples.tsv'
    phenotype_concept_ids          = [432510, 374919]      // OMOP concept IDs for Ischemic Stroke
    target_phenotype_name          = 'Ischemic Stroke'

    // Downsampling settings
    enable_downsampling_for_vds_generation = true
    n_cases_downsample                    = 500
    n_controls_downsample                 = 500
    downsampling_random_state             = 2025

    // GCS directories (all under your WORKSPACE_BUCKET)
    gcs_temp_dir_base      = "${ System.getenv('WORKSPACE_BUCKET') }/prs_analysis_temp_nextflow"
    gcs_hail_temp_dir_base = "${ System.getenv('WORKSPACE_BUCKET') }/hail_temp_nextflow"
    output_dir_base        = "${ System.getenv('WORKSPACE_BUCKET') }/prs_analysis_runs_nextflow"

    // PRS models to run
    models_list = [
        [ id: 'PGS002724', url: 'https://ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/PGS002724/ScoringFiles/Harmonized/PGS002724_hmPOS_GRCh38.txt.gz', phenotype: 'Ischemic Stroke' ],
        [ id: 'PGS000039', url: 'https://ftp.ebi.ac.uk/pub/databases/spot/pgs/scores/PGS000039/ScoringFiles/Harmonized/PGS000039_hmPOS_GRCh38.txt.gz', phenotype: 'Ischemic Stroke' ]
    ]
}

// -------------------------------------------------------
// Environment variables exposed to tasks
// -------------------------------------------------------
env {
    WORKSPACE_BUCKET = System.getenv('WORKSPACE_BUCKET')
    WORKSPACE_CDR    = System.getenv('WORKSPACE_CDR')
    // preserve any existing PYTHONPATH
    PYTHONPATH       = System.getenv('PYTHONPATH')
}

// -------------------------------------------------------
// Disable any containerization: use bare metal
// -------------------------------------------------------
docker {
    enabled = false
}
singularity {
    enabled = false
}
process {
    container = null
}

// -------------------------------------------------------
// Process defaults, no resource caps (will use everything available)
// -------------------------------------------------------
process {
    // use the local executor by default
    executor = 'local'

    // retry on transient failures
    errorStrategy = 'retry'
    maxRetries    = 2

    // DO NOT specify `cpus`, `memory`, or `time`
    // so Nextflow will not constrain resource usage.
}

// -------------------------------------------------------
// Reporting & Monitoring
// -------------------------------------------------------
timeline {
    enabled = true
}
trace {
    enabled = true
}
report {
    enabled = true
}
